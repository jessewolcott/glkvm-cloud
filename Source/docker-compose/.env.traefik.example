# =========================================================
# GLKVM Cloud - Traefik + Let's Encrypt + CrowdSec
# =========================================================
# Copy this file to .env and fill in your values.
# Then run: docker-compose -f docker-compose.traefik.yml up -d
# =========================================================

# =====================================================
# Domain & Certificate Configuration (REQUIRED)
# =====================================================
# Your base domain for GLKVM Cloud.
# Web UI will be at: https://www.DOMAIN and https://DOMAIN
# Device access will be at: https://<device-id>.DOMAIN
DOMAIN=kvm.example.com

# Email for Let's Encrypt certificate notifications
ACME_EMAIL=admin@example.com

# =====================================================
# DigitalOcean API Token (REQUIRED for wildcard certs)
# =====================================================
# Create a token at: https://cloud.digitalocean.com/account/api/tokens
# The token needs read/write access to manage DNS records.
# This is used for DNS-01 challenge to obtain wildcard certificates.
DO_AUTH_TOKEN=your-digitalocean-api-token-here

# =====================================================
# CrowdSec Configuration
# =====================================================
# After first deployment, generate this key by running:
#   docker exec glkvm_crowdsec cscli bouncers add traefik-bouncer
# Then paste the key here and restart Traefik.
CROWDSEC_BOUNCER_API_KEY=

# =====================================================
# Traefik Dashboard (Optional)
# =====================================================
# Basic auth for Traefik dashboard (https://traefik.DOMAIN)
# Generate with: htpasswd -nb admin YourSecurePassword
# Default: admin:admin (CHANGE THIS!)
TRAEFIK_DASHBOARD_AUTH=admin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/

# =====================================================
# Images
# =====================================================
GLKVM_IMAGE=glzhitong/glkvm-cloud:latest
COTURN_IMAGE=coturn/coturn:edge-alpine

# =====================================================
# GLKVM Cloud Access Configuration
# =====================================================
# These are auto-configured based on DOMAIN, but you can override:
# DEVICE_ENDPOINT_HOST=kvm.example.com
# WEB_UI_HOST=www.kvm.example.com

# Public IP for WebRTC/TURN (auto-detected if empty)
GLKVM_ACCESS_IP=

# =====================================================
# GLKVM Cloud Credentials
# =====================================================
# Device connection token (shared secret for device registration)
RTTYS_TOKEN=DeviceTokenYouCanChangeMe

# Web UI password (for legacy password auth)
RTTYS_PASS=StrongP@ssw0rd

# =====================================================
# Port Configuration
# =====================================================
# Internal ports (Traefik handles 80/443 externally)
RTTYS_DEVICE_PORT=5912
RTTYS_WEBUI_PORT=1443
RTTYS_HTTP_PROXY_PORT=10443

# TURN server port (WebRTC media relay)
TURN_PORT=3478
TURN_USER=glkvmcloudwebrtcuser
TURN_PASS=AnotherS3cret

# =====================================================
# LDAP Authentication (Optional)
# =====================================================
LDAP_ENABLED=false
LDAP_SERVER=your-ldap-server.com
LDAP_PORT=389
LDAP_USE_TLS=false
LDAP_BIND_DN=cn=service-account,ou=users,dc=company,dc=com
LDAP_BIND_PASSWORD=service-password
LDAP_BASE_DN=ou=users,dc=company,dc=com

# User filter examples:
# Active Directory: (&(objectClass=person)(sAMAccountName=%s))
# OpenLDAP: (&(objectClass=inetOrgPerson)(uid=%s))
# FreeIPA: (&(objectClass=person)(uid=%s))
LDAP_USER_FILTER=(uid=%s)

LDAP_ALLOWED_GROUPS=admins,operators
LDAP_ALLOWED_USERS=user1,user2

# =====================================================
# OIDC Authentication (Optional)
# =====================================================
OIDC_ENABLED=false
OIDC_ISSUER=
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=
OIDC_AUTH_URL=
OIDC_TOKEN_URL=

# Callback URL (path is fixed, update domain only)
# Example: https://www.kvm.example.com/auth/oidc/callback
OIDC_REDIRECT_URL=

OIDC_SCOPES="openid profile email"

# Whitelists (optional)
OIDC_ALLOWED_USERS=
OIDC_ALLOWED_SUBS=
OIDC_ALLOWED_USERNAMES=
OIDC_ALLOWED_GROUPS=
